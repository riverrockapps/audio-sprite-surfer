"use strict";angular.module("audioSpriteSurferApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).value("demoSpriteJson",'[{"id":"yip","start":504,"end":998,"length":494},{"id":"hip-a-dip","start":1589,"end":2479,"length":890},{"id":"what","start":3209,"end":3869,"length":660},{"id":"scooo","start":4274,"end":5774,"length":1500},{"id":"harrr","start":5989,"end":7264,"length":1275}]').config(["$routeProvider","$locationProvider","$logProvider",function(a){a.when("/",{templateUrl:"views/generator.html",controller:"GeneratorCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("audioSpriteSurferApp").controller("GeneratorCtrl",["$scope","$filter","$timeout","wavesurfer","spriteManager","demoSpriteJson",function(a,b,c,d,e,f){a.wavesurfer=d,a.spriteManager=e,a.model={},a.model.json="",a.model.invalid=!1,a.create=e.create,a.import=function(b){var c;try{c=JSON.parse(b||a.model.json),confirm("Warning!  This will overwrite your existing data.")&&e.import(c)}catch(d){a.model.invalid=!0}},a.export=function(){a.model.json=b("json")(e.export())},a.update=function(){e.active&&e.active.update()},a.delete=e.delete,a.prev=e.prev,a.next=e.next,a.play=function(){d.togglePlaySelection()},a.$watch("model.json",function(b,c){b!==c&&a.model.invalid&&(a.model.invalid=!1)}),d.load("audio/demo.mp3"),d.once("ready",function(){c(function(){e.import(JSON.parse(f)),e.next()})})}]),angular.module("audioSpriteSurferApp").controller("EditCtrl",["$scope","spriteManager",function(a,b){a.spriteManager=b,a.updateFromSelection=b.updateFromSelection,a.$watchCollection("spriteManager.active.model",function(){b.active.update()})}]),angular.module("audioSpriteSurferApp").directive("formNumberSpinner",function(){return{templateUrl:"views/form-number-spinner.html",scope:{item:"=",id:"@",label:"@"},replace:!0,link:function(a){a.keydown=function(b){switch(b.keyCode){case 40:return b.preventDefault(),a.decrease();case 38:return b.preventDefault(),a.increase()}},a.decrease=function(){a.item-=10},a.increase=function(){a.item+=10}}}}),angular.module("audioSpriteSurferApp").directive("waveformSpriteView",function(){return{templateUrl:"views/waveform-sprite-view.html",scope:{spriteManager:"=manager",sprite:"="},replace:!0,link:function(a){a.midpoint=0,a.width=0,a.$watch("sprite.selection",function(b){var c;b&&(c=(b.endPercentage-b.startPercentage)/2,a.midpoint=(100*(b.startPercentage+c)).toFixed(2)+"%",a.width=100*(b.endPercentage-b.startPercentage)+"%")}),a.activate=function(){a.spriteManager.setActive(a.sprite)}}}}),angular.module("audioSpriteSurferApp").directive("waveformSpritesView",["$compile","$timeout","wavesurfer","spriteManager",function(a,b,c,d){return{templateUrl:"views/waveform-sprites-view.html",replace:!0,link:function(a){a.spriteManager=d,a.wavesurfer=c,b(function(){},300)}}}]),angular.module("audioSpriteSurferApp").directive("audioSpriteSurferKeys",["$document","$timeout","wavesurfer","spriteManager",function(a,b,c,d){return{link:function(b){a.bind("keydown",function(a){b.$apply(function(){var b=!1;a.altKey?37===a.keyCode?(d.adjustEnd(-10),b=!0):39===a.keyCode&&(d.adjustEnd(10),b=!0):a.shiftKey?37===a.keyCode?(d.adjustStart(-10),b=!0):39===a.keyCode&&(d.adjustStart(10),b=!0):a.ctrlKey&&(37===a.keyCode?d.prev():39===a.keyCode?d.next():13===a.keyCode?d.create():46===a.keyCode&&d.delete()),b&&(a.preventDefault(),a.stopPropagation())})}),a.bind("keypress",function(a){switch(a.keyCode){case 32:return a.preventDefault(),c.togglePlaySelection()}})}}}]),angular.module("audioSpriteSurferApp").directive("spriteFocusInput",["$rootScope",function(a){return{link:function(b,c){a.$on("sprite.focus",function(){c[0].focus()})}}}]),angular.module("audioSpriteSurferApp").factory("spriteManager",["$rootScope","$timeout","wavesurfer","Sprite",function(a,b,c,d){var e={};return e.sprites=[],e.active=null,e.reset=function(){for(;e.sprites.length>0;)e.sprites.pop()},e.create=function(){var f=c.getSelection();if(f){var g=new d;e.sprites.push(g),b(function(){e.setActive(g),a.$broadcast("sprite.focus",g)})}},e.import=function(a){e.reset(),a.forEach(function(a){var b=new d(a);e.sprites.push(b)})},e.export=function(){var a=e.sprites.map(function(a){var b={id:a.model.id.toString(),start:a.model.start,end:a.model.end};return b.length=b.end-b.start,b});return a},e.next=function(){var b=e.sprites.indexOf(e.active),c=e.sprites.length;e.active=e.sprites[(b+c+1)%c],a.$broadcast("sprite.focus",e.active)},e.prev=function(){var b=e.sprites.indexOf(e.active),c=e.sprites.length;e.active=e.sprites[(b+c-1)%c],a.$broadcast("sprite.focus",e.active)},e.delete=function(){var a=e.sprites.indexOf(e.active);e.sprites.splice(a,1),e.prev()},e.setActive=function(a){e.active=a,e.active.updateToSelection()},e.adjustEnd=function(a){e.active.model.end+=a},e.adjustStart=function(a){e.active.model.start+=a},document.querySelector("#drop").addEventListener("drop",function(){b(function(){e.reset()})}),e}]),angular.module("audioSpriteSurferApp").factory("Sprite",["wavesurfer",function(a){var b=0,c=function(a){this.model=a||{},"undefined"==typeof this.model.id&&(this.model.id=b++),this.model.start&&this.model.end||this.updateFromSelection(),this.update()};return c.prototype.updateFromSelection=function(){var b=a.getSelection();b&&(this.model.start=Math.floor(1e3*b.startPosition),this.model.end=Math.floor(1e3*b.endPosition),this.selection=b)},c.prototype.updateToSelection=function(){var b,c,d;b=this.model.start/1e3,c=this.model.end/1e3,d=a.region({id:"test",startPosition:b,endPosition:c}),a.clearRegions(),a.updateSelection(d),a.mark({id:"start",color:"#0B3E6B",position:b}),a.mark({id:"end",color:"#0B3E6B",position:c})},c.prototype.update=function(){this.updateToSelection(),this.updateFromSelection()},c}]),angular.module("audioSpriteSurferApp").value("wavesurferOptions",{loopSelection:!1,waveColor:"#3e68a7",progressColor:"#0B3E6B",loaderColor:"#3e68a7",selectionColor:"#ffd83f",cursorColor:"#0B3E6B",markerWidth:1,minPxPerSec:200,scrollParent:!0}).factory("wavesurfer",["$rootScope","$window","$timeout","wavesurferOptions",function(a,b,c,d){var e=Object.create(b.WaveSurfer);d.container=document.querySelector("#waveform"),e.init(d),e.togglePlaySelection=function(){e.playPauseSelection()},e.on("mark",function(a){c(function(){var b=e.getSelection();a.position>=b.endPosition&&e.togglePlaySelection()})});var f=function(a,b){a.stopPropagation(),a.preventDefault(),b?a.target.classList.add("wavesurfer-dragover"):a.target.classList.remove("wavesurfer-dragover")},g={drop:function(a){f(a,!1),a.dataTransfer.files.length?e.loadBlob(a.dataTransfer.files[0]):e.fireEvent("error","Not a file")},dragover:function(a){f(a,!0)},dragleave:function(a){f(a,!1)}},h=document.querySelector("#drop");return Object.keys(g).forEach(function(a){h.addEventListener(a,g[a])}),e}]),angular.module("audioSpriteSurferApp").factory("spriteCache",["$window",function(){var a={};return a}]),angular.module("audioSpriteSurferApp").factory("unloadCheck",["$window",function(a){var b={};return a.onbeforeunload=function(b){var c="WARNING:  You may lose all your sprites!";return b=b||a.event,b&&(b.returnValue=c),c},a.onunload=function(){},b}]).run(["unloadCheck",function(){}]),angular.module("audioSpriteSurferApp").filter("encodeUri",function(){return encodeURIComponent});